<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:BrainWaves.ViewModels"
             xmlns:resource="clr-namespace:BrainWaves.Resources.Strings" 
             xmlns:helpers="clr-namespace:BrainWaves.Helpers"
             xmlns:customControls="clr-namespace:BrainWaves.CustomControls"
             NavigationPage.HasNavigationBar="False"
             Title="{Binding Title}"
             x:Name="ScanPageRef"
             BackgroundColor="{AppThemeBinding Dark={StaticResource BackgroundColorDarkTheme}, Light={StaticResource BackgroundColorLight}}"
             x:Class="BrainWaves.Views.ScanPage">
    <ContentPage.BindingContext>
        <viewModels:ScanViewModel/>
    </ContentPage.BindingContext>

    <Grid>
        <StackLayout Orientation="Vertical" BackgroundColor="{AppThemeBinding Dark=Black, Light=CadetBlue}">
            <customControls:CustomToolbar
                BackgroundColorProp="{StaticResource PrimaryColor}"
                LeftButtonIsVisibleProp="False"
                TitleText="{Binding Title}"
                CustomTextColorProp="White"
                RightButtonIsVisibleProp="True"
                RightButtonTitleTextProp="{Static resource:Resource.Settings}"
                RightButtonCommand="{Binding GoToSettingsCommand}"
                RightButtonCommandParameter="{Binding GoToSettingsCommand}"
                RightButtonTextColorProp="White"/>
            
            <Button
                Style="{StaticResource ButtonStyleNormal}"
                BorderWidth="2"
                WidthRequest="200"
                Margin="10"
                Command="{Binding ScanDevicesCommand}"
                Text="{Static resource:Resource.ScanButtonText}" 
                IsVisible="{Binding IsScanning, Converter={helpers:InverseBoolConverter}}"/>

            <Button
                Style="{StaticResource ButtonStyleNormal}"
                Margin="10"
                Command="{Binding StopScanningCommand}"
                Text="{Static resource:Resource.StopScanningText}"
                IsVisible="{Binding IsScanning}"/>

            <Label
                Text="{Binding InfoMessage}"
                Style="{StaticResource LabelStyleNormal}"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                IsVisible="{Binding IsInfoVisible}"
                TextColor="White"/>

            <customControls:ActivityIndicatorWithLabel
                HorizontalOptionsProp="Center"
                VerticalOptions="Center"
                LeftLabelIsVisible="True"
                LeftTitleText="{Binding BusyMessage}"
                LabelTextColorProp="ForestGreen"
                RightLabelIsVisible="False"
                ActivityIndicatorColorProp="ForestGreen"
                ActivityIndicatorIsVisible="{Binding IsBusy}" />

            <ListView
                x:Name="DevicesList"
                ItemsSource="{Binding GattDevices}"
                ItemTapped="DevicesList_ItemTapped">
            </ListView>
        </StackLayout>
        
    </Grid>
</ContentPage>